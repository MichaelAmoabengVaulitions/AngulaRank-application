<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AngulaRank-application</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.1/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />


</head>
<body>
  <!--Main App area-->

  <div class="container">
    <nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><i class="fa fa-github" aria-hidden="true"></i>AngulaRank</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#/route1">Repository Details</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Rank Contributors by<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#/route2">Number of contributions</a></li>
              <li><a href="#/route3">Number of followers</a></li>
              <li><a href="#/route4">Repositories published</a></li>
            </ul>
          </li>
        </ul>

      </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
  </nav>
<hr/>
        <div class="row">
          <div class="col col-md-8">
            <div class="page"></div>
          </div>
        </div>



  </div>
  <!--Contributors template-->
  <script type="text/template" id="contributors-template">

      <!--<div class="jumbotron">
        <strong>Contributor's Details</strong>
        <% _.each(obj.contributors, function(contributor){ %>
        <div id="details" class="collapse">
            Followers_url: <%- contributor.get('followers_url') %><br/>
            Organizations_url: <%- contributor.get('organizations_url') %><br/>
            Subscriptions_url:<%- contributor.get('subscriptions_url') %><br/>
            Repositories_url: <%- contributor.get('repos_url') %><br/>
            Gists_url: <%- contributor.get('gists_url') %>
        </div>
        <% }); %>
      </div>-->

        <table class="table table-striped">
          <thead class="thead-default">
            <tr>
              <th>User Name</th>
              <th>URL</th>
              <th>User Type</th>
              <th>Number of Contributions</th>
            </tr>
          </thead>
          <tbody>
            <% _.each(obj.contributors, function(contributor){ %>
              <tr>
                <td><%- contributor.get('login') %></td>
                <td><a href="<%- contributor.get('html_url') %>"><%- contributor.get('html_url') %></a></td>
                <td><%- contributor.get('user') %></td>
                <td><%- contributor.get('contributions') %></td>
                <td><button class="btn btn-info" data-toggle="collapse" data-target="#details"><a href="#/route5/<%- contributor.get('id') %>">Show details</a></button></td>
                </tr>
            <% }); %>
          </tbody>
        </table>

  </script>



  <!--Repository Details template-->
  <script type="text/template" id="repo-Details">

      <div class="jumbotron">
        <strong>Repository Details</strong>
          <% _.each(obj.contributors, function(contributor){ %>
            <%- contributor.get('contributions') %>
            <% }); %>
      </div>
  </script>

  <!--Contributors Details template-->
  <script type="text/template" id="contributors-details-template">
    <div class="row">
      <div class="col col-md-8">
        <h3>Details</h3>
        <hr/>

        <strong></strong>
      </div>
    </div>
  </script>

  <!--Including necessary dependencies-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.1/js/bootstrap.min.js"></script>



  <!--Backbone.js code(Doing everything inline but module system is recommended)-->
  <script>
  //Appending a jQuery prefilter function
  $.ajaxPrefilter(function(options, originalOptions, jqXHR){
    options.url = "https://api.github.com/repos/angular/angular" + options.url;
  });

   //Backbone contributors collection from GitHub developer API

   //Contributors Model
var Contributor = Backbone.Model.extend({
   urlRoot: '/contributors'

});


   // Contributors collection
   var Contributors = Backbone.Collection.extend({
     model: Contributor,
     url: '/contributors'
   });

   var RepositoryDetails = Backbone.Collection.extend({
     url: 'https://api.github.com/repos/angular/angular'
   });


   //Backbone view to render list of Angular repo contributors
   var ContributorsList = Backbone.View.extend({
     el: '.page',
     render: function () {
       var that = this;
       var contributor = new Contributor();
       var contributors = new Contributors();
       contributors.fetch({
         success: function (contributors) {
           var template = _.template($('#contributors-template').html(),{contributors:contributors.models});
           that.$el.html(template);
         }
       })
     }

   });

   //Backbone view to render the repository details
   var RepositoryDetails = Backbone.View.extend({
     el: '.page',
     render: function () {
           var template = _.template($('#repo-Details').html(), {repositoryDetails:repositoryDetails.models});
           this.$el.html(template);
     }
   });


   //Backbone view to render the contributors details
   var ContributorDetails = Backbone.View.extend({
     el: '.page',
     render: function (options) {
       var that = this;
       if(options.id){
         //GET request to get the details
         var contributor = new Contributor({id : options.id});
         //Fetch contibutor by id
         contributor.fetch({
           success: function (contributor) {
             var template = _.template($('#contributors-details-template').html(),{contributor : contributor});
             that.$el.html(template);
           }
         })
       }else {
         var template = _.template($('#contributors-details-template').html(),{contributor : null});
         this.$el.html(template);
       }

     }
   });

    //Routers
    var Router = Backbone.Router.extend({
      routes: {
        '':'home',
        'route1':'repoDetails',
        'route2':'numContributions',
        'route3':'numFollowers',
        'route4':'reposPublished',
        'route5/:id':'contributorDetails'
      }
    });

    //Creating instance of View to render list of Angular repo contributors
    var contributorsList = new ContributorsList();

    //Instance of the new model
    var contributor = new Contributor();

    //Instance of view to render the repository details
    var repositoryDetails = new RepositoryDetails();

    //Instance of view to render the cotributors details
    var contributorDetails = new ContributorDetails();

    //Creating instance of Homepage Router
    var router = new Router();
    router.on('route:home', function () {
      contributorsList.render();
    });

    //Creating instance of repository details Router
    router.on('route:repoDetails', function () {
      repositoryDetails.render();
    });

    //Creating instance of rank by number of contributions Router
    router.on('route:numContributions', function () {
      console.log("show rank by number of contributions to a repository");
    });

    //Creating instance of rank by number of followers Router
    router.on('route:numFollowers', function () {
      console.log("show rank by number of followers to a repository");
    });

    //Creating instance of rank by number of repositories publisded Router
    router.on('route:reposPublished', function () {
      console.log("show rank by number of repositories published");
    });


    //Creating instance of contributor details Router
    router.on('route:contributorDetails', function (id) {
      contributorDetails.render({id : id});
    });




    //Kickstart backbone
    Backbone.history.start();
  </script>

</body>
</html>
